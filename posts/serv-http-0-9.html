<html>
	<head>
		<link rel="stylesheet" href="../style.css" media="screen" />
		<title>Cozis - Scriviamo un web server!</title>
	</head>
	<body>
		<a href="../index.html">Indice</a>

		<h1>Scriviamo un web server HTTP/0.9 in C!</h1>
		<p>In questa guida intendo mostrare come si può creare una prima versione di web server in C su Linux.</p>

		<p><b>NOTA</b>: Questo articolo non è ancora completo!</p>

		<h2>1. Un po' di teoria..</h2>

		<h3>1.1 Ma cos'è un web server?</h3>
		<p>In generale, un'architettura client-server di un sistema software è quella in cui c'è un programma chiamato client che manda delle "richieste" ad un'altro chiamato server, che eventualmente manda delle "risposte" al primo. In generale, le richieste possono essere qualsiasi cosa.</p>

		<p>Nel caso dei web server, quello che è scambiato fra client e server sono file, o, più in generale, testo. Per far si che avvenga una comunicazione di successo fra client e server, questi devono essere d'accordo a priori su come comunicare, ossia devono condividere lo stesso protocollo. Nel caso dei <i>web</i> server, il protocollo è chiamato <b>HyperText Transfer Protocol</b> (<b>HTTP</b>). Il protocollo HTTP è un protocollo di trasferimento di ipertest, cioè file collegati fra di loro mediante quelli che comunemente chiamiamo <i>link</i>.</p>

		<h3>1.2 Il protocollo HTTP</h3>
		<p>Questo protocollo ha acquisito una grande importanza negli anni ed è stato messo a dura prova dalle esigenze della società. Basta immaginare che il web, nato per scambiare documenti testuali, è praticamente diventato una piattaforma di scambio di applicazioni molto sofisticate. Per questo motivo ha subito una grande trasformazione. Quindi il protocollo ha varie vesioni (HTTP/0.9, HTTP/1.0, HTTP/1.1, HTTP/2, HTTP/3) che diventano esponenzialmente più sofisticate perchè cercano di risolvere problemi sempre più particolari. L'impressione che ho è che la versione più in uso sia ancora HTTP/1.1.</p>

		<p>In questa guida, guarderemo solo la prima versione. Una richiesta HTTP/0.9 ha la forma</p>
		<textarea disabled>GET file.txt</textarea>
		<p>dove al posto di file.txt può esserci un qualsiasi nome di file. Il server, a sua volta, rispondera con il contenuto del file. La risposta del server deve essere HTML. Se qualcosa va storto (ad esempio il file non esiste), allora l'errore può essere comunicato al client in formato HTML. Una volta avvenuta la risposta, la transazione è conclusa con la chiusura della connessione da parte del server.</p>

		<h2>2. Programmiamo!</h2>
		<p>Il modo in cui procederemo è scrivendo un web server e poi effettuando richieste con il nostro browser preferito (Firefox, chrome, brave?).</p>

		<h3>2.1 Creiamo un server TCP</h3>

		<p>Un server HTTP è usualmente implementato su una connessione TCP aperta sulla porta 80. Quindi dovremo creare un server TCP prima. Per alleggerire questo articolo ho diviso la parte in cui spiego cos'è e come si realizza un server TCP <a href="serv-tcp.html">qui</a>. Del resto il protocollo HTTP poggia sul protocollo TCP (o qualsiasi altro protocollo orientato alla connessione). Il TCP specifica come i byte vengono trasferiti fra due computer, mentre l'HTTP specifica cosa viene comunicato. Senza dilungarci troppo, costruiamo una struttura analoga a quella che abbiamo costruito alla fine dell'altro post</p>

		<div class="c2h-code">
  <div class="c2h-code-inner">
    <table>
      <tr><td>1</td><td></td></tr>
      <tr><td>2</td><td><span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier c2h-fdeclname">main</span>()</td></tr>
      <tr><td>3</td><td>{</td></tr>
      <tr><td>4</td><td>    <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">port</span> <span class="c2h-operator">=</span> <span class="c2h-val-int">80</span>;</td></tr>
      <tr><td>5</td><td></td></tr>
      <tr><td>6</td><td>    <span class="c2h-comment">// Chiediamo al sistema operativo di aprire un socket TCP.</span></td></tr>
      <tr><td>7</td><td>    <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">fd</span> <span class="c2h-operator">=</span> <span class="c2h-identifier c2h-fcallname">socket</span>(<span class="c2h-identifier">AF_INET</span>, <span class="c2h-identifier">SOCK_STREAM</span>, <span class="c2h-val-int">0</span>);</td></tr>
      <tr><td>8</td><td></td></tr>
      <tr><td>9</td><td>    <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">fd</span> <span class="c2h-operator">&lt;</span> <span class="c2h-val-int">0</span>)</td></tr>
      <tr><td>10</td><td>        {</td></tr>
      <tr><td>11</td><td>            <span class="c2h-identifier c2h-fcallname">fprintf</span>(<span class="c2h-identifier">stderr</span>, <span class="c2h-val-str">"Non sono riuscito ad aprire il socket!\n"</span>);</td></tr>
      <tr><td>12</td><td>            <span class="c2h-kword c2h-kword-return">return</span> <span class="c2h-operator">-</span><span class="c2h-val-int">1</span>;</td></tr>
      <tr><td>13</td><td>        }</td></tr>
      <tr><td>14</td><td></td></tr>
      <tr><td>15</td><td>    <span class="c2h-comment">// Ora specifichiamo al sistema operativo a quale indirizzo</span></td></tr>
      <tr><td>16</td><td>    <span class="c2h-comment">// (e porta) vogliamo ascoltare per le richieste. La porta</span></td></tr>
      <tr><td>17</td><td>    <span class="c2h-comment">// alla quale siamo interessati è la 80, mentre per l'indirizzo</span></td></tr>
      <tr><td>18</td><td>    <span class="c2h-comment">// IP ci va bene qualsiasi sia a nostra disposizione, quindi</span></td></tr>
      <tr><td>19</td><td>    <span class="c2h-comment">// usiamo INADDR_ANY.</span></td></tr>
      <tr><td>20</td><td>    {</td></tr>
      <tr><td>21</td><td>        <span class="c2h-kword c2h-kword-struct">struct</span> <span class="c2h-identifier">sockaddr_in</span> <span class="c2h-identifier">addr</span>;</td></tr>
      <tr><td>22</td><td>        <span class="c2h-identifier c2h-fcallname">memset</span>(<span class="c2h-operator">&</span><span class="c2h-identifier">addr</span>, <span class="c2h-val-int">0</span>, <span class="c2h-kword c2h-kword-sizeof">sizeof</span>(<span class="c2h-kword c2h-kword-struct">struct</span> <span class="c2h-identifier">sockaddr_in</span>));</td></tr>
      <tr><td>23</td><td>        <span class="c2h-identifier">addr</span>.<span class="c2h-identifier">sin_family</span> <span class="c2h-operator">=</span> <span class="c2h-identifier">AF_INET</span>;</td></tr>
      <tr><td>24</td><td>        <span class="c2h-identifier">addr</span>.<span class="c2h-identifier">sin_port</span>   <span class="c2h-operator">=</span> <span class="c2h-identifier c2h-fcallname">htons</span>(<span class="c2h-identifier">port</span>);</td></tr>
      <tr><td>25</td><td>        <span class="c2h-identifier">addr</span>.<span class="c2h-identifier">s_addr</span>.<span class="c2h-identifier">sin_addr</span> <span class="c2h-operator">=</span> <span class="c2h-identifier">INADDR_ANY</span>;</td></tr>
      <tr><td>26</td><td></td></tr>
      <tr><td>27</td><td>        <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier c2h-fcallname">bind</span>(<span class="c2h-identifier">fd</span>, (<span class="c2h-kword c2h-kword-struct">struct</span> <span class="c2h-identifier">sockaddr</span><span class="c2h-operator">*</span>) <span class="c2h-operator">&</span><span class="c2h-identifier">addr</span>, <span class="c2h-kword c2h-kword-sizeof">sizeof</span>(<span class="c2h-identifier">addr</span>)))</td></tr>
      <tr><td>28</td><td>            {</td></tr>
      <tr><td>29</td><td>                <span class="c2h-identifier c2h-fcallname">fprintf</span>(<span class="c2h-identifier">stderr</span>, <span class="c2h-val-str">"Non sono riuscito ad associare il socket all'indirizzo.\n"</span>);</td></tr>
      <tr><td>30</td><td>                </td></tr>
      <tr><td>31</td><td>                <span class="c2h-identifier c2h-fcallname">close</span>(<span class="c2h-identifier">fd</span>);</td></tr>
      <tr><td>32</td><td>                <span class="c2h-kword c2h-kword-return">return</span> <span class="c2h-operator">-</span><span class="c2h-val-int">1</span>;</td></tr>
      <tr><td>33</td><td>            }</td></tr>
      <tr><td>34</td><td>    }</td></tr>
      <tr><td>35</td><td></td></tr>
      <tr><td>36</td><td>    <span class="c2h-comment">// Ora cominciamo ad ascoltare le richieste.</span></td></tr>
      <tr><td>37</td><td>    <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier c2h-fcallname">listen</span>(<span class="c2h-identifier">fd</span>, <span class="c2h-val-int">8</span>))</td></tr>
      <tr><td>38</td><td>        {</td></tr>
      <tr><td>39</td><td>            <span class="c2h-identifier c2h-fcallname">fprintf</span>(<span class="c2h-identifier">stderr</span>, <span class="c2h-val-str">"Non sono riuscito ad cominciare ad ascolare.\n"</span>);</td></tr>
      <tr><td>40</td><td>            </td></tr>
      <tr><td>41</td><td>            <span class="c2h-identifier c2h-fcallname">close</span>(<span class="c2h-identifier">fd</span>);</td></tr>
      <tr><td>42</td><td>            <span class="c2h-kword c2h-kword-return">return</span> <span class="c2h-operator">-</span><span class="c2h-val-int">1</span>;</td></tr>
      <tr><td>43</td><td>        }</td></tr>
      <tr><td>44</td><td></td></tr>
      <tr><td>45</td><td>    <span class="c2h-comment">// ..Ora siamo pronti a ricevere richieste.</span></td></tr>
      <tr><td>46</td><td></td></tr>
      <tr><td>47</td><td>    <span class="c2h-kword c2h-kword-while">while</span>(<span class="c2h-val-int">1</span>)</td></tr>
      <tr><td>48</td><td>        {</td></tr>
      <tr><td>49</td><td>            <span class="c2h-comment">// Accetto una connessione.</span></td></tr>
      <tr><td>50</td><td></td></tr>
      <tr><td>51</td><td>            <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">cfd</span>;</td></tr>
      <tr><td>52</td><td>            {</td></tr>
      <tr><td>53</td><td>                <span class="c2h-kword c2h-kword-struct">struct</span> <span class="c2h-identifier">sockaddr_in</span> <span class="c2h-identifier">addr</span>;</td></tr>
      <tr><td>54</td><td>                <span class="c2h-identifier">socklen_t</span>          <span class="c2h-identifier">size</span> <span class="c2h-operator">=</span> <span class="c2h-kword c2h-kword-sizeof">sizeof</span>(<span class="c2h-identifier">addr</span>):</td></tr>
      <tr><td>55</td><td></td></tr>
      <tr><td>56</td><td>                <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">cfd</span> <span class="c2h-operator">=</span> <span class="c2h-identifier c2h-fcallname">accept</span>(<span class="c2h-identifier">fd</span>, (<span class="c2h-kword c2h-kword-struct">struct</span> <span class="c2h-identifier">sockaddr</span><span class="c2h-operator">*</span>) <span class="c2h-operator">&</span><span class="c2h-identifier">addr</span>, <span class="c2h-identifier">size</span>);</td></tr>
      <tr><td>57</td><td></td></tr>
      <tr><td>58</td><td>                <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">cfd</span> <span class="c2h-operator">&lt;</span> <span class="c2h-val-int">0</span>)</td></tr>
      <tr><td>59</td><td>                    {</td></tr>
      <tr><td>60</td><td>                        <span class="c2h-comment">// Uops! Qualcosa è andato storto mentre cercavamo</span></td></tr>
      <tr><td>61</td><td>                        <span class="c2h-comment">// di accettare una nuove connessione. </span></td></tr>
      <tr><td>62</td><td></td></tr>
      <tr><td>63</td><td>                        <span class="c2h-comment">// Continuiamo con la prossima richiesta.</span></td></tr>
      <tr><td>64</td><td>                        <span class="c2h-kword c2h-kword-continue">continue</span>; <span class="c2h-comment">// Torna dinuovo al passo 1.</span></td></tr>
      <tr><td>65</td><td>                    }</td></tr>
      <tr><td>66</td><td>            }</td></tr>
      <tr><td>67</td><td></td></tr>
      <tr><td>68</td><td>            <span class="c2h-comment">// ..Leggo la richiesta e rispondo appositamente..</span></td></tr>
      <tr><td>69</td><td></td></tr>
      <tr><td>70</td><td>            <span class="c2h-comment">// Chiudo la connessione.</span></td></tr>
      <tr><td>71</td><td>            <span class="c2h-identifier c2h-fcallname">close</span>(<span class="c2h-identifier">cfd</span>);</td></tr>
      <tr><td>72</td><td>        }</td></tr>
      <tr><td>73</td><td></td></tr>
      <tr><td>74</td><td>    <span class="c2h-comment">// Ora chiudiamo il socket.</span></td></tr>
      <tr><td>75</td><td>    <span class="c2h-identifier c2h-fcallname">close</span>(<span class="c2h-identifier">fd</span>);</td></tr>
      <tr><td>76</td><td></td></tr>
      <tr><td>77</td><td>    <span class="c2h-comment">// NOTA: In effetti chiudere il socket è inutile dato che</span></td></tr>
      <tr><td>78</td><td>    <span class="c2h-comment">//       il loop precedente non terminerà mai, ma noi lo</span></td></tr>
      <tr><td>79</td><td>    <span class="c2h-comment">//       facciamo comunque perchè è una buona abitudine.</span></td></tr>
      <tr><td>80</td><td>    <span class="c2h-kword c2h-kword-return">return</span> <span class="c2h-val-int">0</span>;</td></tr>
      <tr><td>81</td><td>}</td></tr>
      <tr><td>82</td><td></td></tr>
      <tr><td>83</td><td>        </td></tr>
    </table>
  </div>
</div>


		<p>Ora ci possiamo occupare del cuore del problema, cioè ricevere, interpretare e gestire le richieste.</p>

		<div class="c2h-code">
  <div class="c2h-code-inner">
    <table>
      <tr><td>1</td><td></td></tr>
      <tr><td>2</td><td><span class="c2h-kword c2h-kword-char">char</span> <span class="c2h-identifier">buffer</span>[<span class="c2h-val-int">256</span>];</td></tr>
      <tr><td>3</td><td><span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">n</span>;</td></tr>
      <tr><td>4</td><td>{        </td></tr>
      <tr><td>5</td><td>    <span class="c2h-comment">// Assumiamo che il contenuto della richiesta non può contenere più </span></td></tr>
      <tr><td>6</td><td>    <span class="c2h-comment">// di 255 caratteri. Questo numero è arbitrario e, fondamentalmente,</span></td></tr>
      <tr><td>7</td><td>    <span class="c2h-comment">// si basa su quanto crediamo che saranno lunghi i nomi dei file</span></td></tr>
      <tr><td>8</td><td>    <span class="c2h-comment">// contenuti nelle richieste. Abbiamo fatto si che il buffer avesse</span></td></tr>
      <tr><td>9</td><td>    <span class="c2h-comment">// un byte in più rispetto al massimo in modo da capire se il client</span></td></tr>
      <tr><td>10</td><td>    <span class="c2h-comment">// ha mandato una richiesta più grande del dovuto.</span></td></tr>
      <tr><td>11</td><td></td></tr>
      <tr><td>12</td><td>    <span class="c2h-comment">// Leggiamo nel buffer il contenuto della richiesta.</span></td></tr>
      <tr><td>13</td><td>    <span class="c2h-identifier">n</span> <span class="c2h-operator">=</span> <span class="c2h-identifier c2h-fcallname">read</span>(<span class="c2h-identifier">cfd</span>, <span class="c2h-identifier">buffer</span>, <span class="c2h-kword c2h-kword-sizeof">sizeof</span>(<span class="c2h-identifier">buffer</span>));</td></tr>
      <tr><td>14</td><td></td></tr>
      <tr><td>15</td><td>    <span class="c2h-comment">// Se un errore è avvenuto, allora [n] è negativo. Se il client si è</span></td></tr>
      <tr><td>16</td><td>    <span class="c2h-comment">// disconnesso prima di inviare qualcosa, allora [n] è zero. Altrimenti</span></td></tr>
      <tr><td>17</td><td>    <span class="c2h-comment">// [n] è pari al numero di byte copiati nel buffer. Se il buffer è</span></td></tr>
      <tr><td>18</td><td>    <span class="c2h-comment">// completamente riempito, è possibile che il client abbia inviato più</span></td></tr>
      <tr><td>19</td><td>    <span class="c2h-comment">// dati di quelli che potevano entrare nel buffer. Questi dati in più</span></td></tr>
      <tr><td>20</td><td>    <span class="c2h-comment">// avremmo potuti leggerli chiamando una seconda volta [read]. Noi però</span></td></tr>
      <tr><td>21</td><td>    <span class="c2h-comment">// non siamo interessati a farlo.</span></td></tr>
      <tr><td>22</td><td></td></tr>
      <tr><td>23</td><td>    <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">n</span> <span class="c2h-operator">&lt;</span> <span class="c2h-val-int">0</span>)</td></tr>
      <tr><td>24</td><td>        {</td></tr>
      <tr><td>25</td><td>            <span class="c2h-comment">// Abbiamo avuto problemi durante la lettura.</span></td></tr>
      <tr><td>26</td><td>            <span class="c2h-comment">// Chiudiamo la connessione e torniamo al passo 1.</span></td></tr>
      <tr><td>27</td><td>            <span class="c2h-identifier c2h-fcallname">close</span>(<span class="c2h-identifier">cfd</span>);</td></tr>
      <tr><td>28</td><td>            <span class="c2h-kword c2h-kword-continue">continue</span>;</td></tr>
      <tr><td>29</td><td>        }</td></tr>
      <tr><td>30</td><td></td></tr>
      <tr><td>31</td><td>    <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">n</span> <span class="c2h-operator">==</span> <span class="c2h-val-int">0</span>)</td></tr>
      <tr><td>32</td><td>        {</td></tr>
      <tr><td>33</td><td>            <span class="c2h-comment">// Il client si è disconnesso prima di ricevere la </span></td></tr>
      <tr><td>34</td><td>            <span class="c2h-comment">// risposta.</span></td></tr>
      <tr><td>35</td><td>            <span class="c2h-comment">// Chiudiamo la connessione e torniamo al passo 1.</span></td></tr>
      <tr><td>36</td><td>            <span class="c2h-identifier c2h-fcallname">close</span>(<span class="c2h-identifier">cfd</span>);</td></tr>
      <tr><td>37</td><td>            <span class="c2h-kword c2h-kword-continue">continue</span>;</td></tr>
      <tr><td>38</td><td>        }</td></tr>
      <tr><td>39</td><td></td></tr>
      <tr><td>40</td><td>    <span class="c2h-comment">// Ok, abbiamo letto [n] byte. Se [n] è pari alla dimensione</span></td></tr>
      <tr><td>41</td><td>    <span class="c2h-comment">// del buffer (quindi è più lunga del massimo, cioè la dimensione</span></td></tr>
      <tr><td>42</td><td>    <span class="c2h-comment">// del buffer meno 1), allora dobbiamo comunicare al client</span></td></tr>
      <tr><td>43</td><td>    <span class="c2h-comment">// l'errore. Questo però lo facciamo nella prossima fase.</span></td></tr>
      <tr><td>44</td><td>}</td></tr>
      <tr><td>45</td><td></td></tr>
      <tr><td>46</td><td><span class="c2h-comment">//   3. Rispondere.</span></td></tr>
      <tr><td>47</td><td></td></tr>
      <tr><td>48</td><td><span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">n</span> <span class="c2h-operator">==</span> <span class="c2h-kword c2h-kword-sizeof">sizeof</span>(<span class="c2h-identifier">buffer</span>))</td></tr>
      <tr><td>49</td><td>    {</td></tr>
      <tr><td>50</td><td>        <span class="c2h-comment">// Il client ha mandato una richiesta troppo grande.</span></td></tr>
      <tr><td>51</td><td>        ..</td></tr>
      <tr><td>52</td><td>    }</td></tr>
      <tr><td>53</td><td><span class="c2h-kword c2h-kword-else">else</span></td></tr>
      <tr><td>54</td><td>    {</td></tr>
      <tr><td>55</td><td>        <span class="c2h-comment">// Il client ha inviato la quantità giusta di dati</span></td></tr>
      <tr><td>56</td><td>        <span class="c2h-comment">// perchè il 256-esimo byte non è stato usato. Per</span></td></tr>
      <tr><td>57</td><td>        <span class="c2h-comment">// questo motivo sappiamo di poter mettere uno zero</span></td></tr>
      <tr><td>58</td><td>        <span class="c2h-comment">// alla fine dei contenuti del buffer per renderlo </span></td></tr>
      <tr><td>59</td><td>        <span class="c2h-comment">// una valida stringa C.</span></td></tr>
      <tr><td>60</td><td></td></tr>
      <tr><td>61</td><td>        <span class="c2h-identifier">buffer</span>[<span class="c2h-identifier">n</span>] <span class="c2h-operator">=</span> <span class="c2h-val-char">'\0'</span>;</td></tr>
      <tr><td>62</td><td></td></tr>
      <tr><td>63</td><td>        <span class="c2h-comment">// Se non avessimo deciso di aggiungere un byte in</span></td></tr>
      <tr><td>64</td><td>        <span class="c2h-comment">// più al buffer, allora nel caso in cui tutto il</span></td></tr>
      <tr><td>65</td><td>        <span class="c2h-comment">// buffer fosse usato non avremmo avuto lo spazio</span></td></tr>
      <tr><td>66</td><td>        <span class="c2h-comment">// per uno zero finale.</span></td></tr>
      <tr><td>67</td><td></td></tr>
      <tr><td>68</td><td>        <span class="c2h-comment">// Il buffer deve contenere una cosa del tipo "GET xyz",</span></td></tr>
      <tr><td>69</td><td>        <span class="c2h-comment">// dove "xyz" è una qualsiasi stringa di caratteri</span></td></tr>
      <tr><td>70</td><td>        <span class="c2h-comment">// non contenente spazi.</span></td></tr>
      <tr><td>71</td><td></td></tr>
      <tr><td>72</td><td>        <span class="c2h-comment">// Notiamo che nel buffer c'è almeno un carattere.</span></td></tr>
      <tr><td>73</td><td>        <span class="c2h-identifier c2h-fcallname">assert</span>(<span class="c2h-identifier">n</span> <span class="c2h-operator">&gt;</span> <span class="c2h-val-int">0</span>);</td></tr>
      <tr><td>74</td><td></td></tr>
      <tr><td>75</td><td>        <span class="c2h-comment">// Sappiamo che la richiesta, per essere valida, deve</span></td></tr>
      <tr><td>76</td><td>        <span class="c2h-comment">// contenere come minimo 5 caratteri, perchè "GET" e</span></td></tr>
      <tr><td>77</td><td>        <span class="c2h-comment">// lo spazio successivo sono 4, e il nome del file</span></td></tr>
      <tr><td>78</td><td>        <span class="c2h-comment">// deve avere come minimo dimensione 1.</span></td></tr>
      <tr><td>79</td><td></td></tr>
      <tr><td>80</td><td>        <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">n</span> <span class="c2h-operator">&lt;</span> <span class="c2h-val-int">5</span>)</td></tr>
      <tr><td>81</td><td>            {</td></tr>
      <tr><td>82</td><td>                <span class="c2h-comment">// Richiesta non valida</span></td></tr>
      <tr><td>83</td><td>                ..</td></tr>
      <tr><td>84</td><td>            }</td></tr>
      <tr><td>85</td><td></td></tr>
      <tr><td>86</td><td>        <span class="c2h-comment">// Ora possiamo assicurarci che cominci con "GET"</span></td></tr>
      <tr><td>87</td><td>        <span class="c2h-comment">// seguito da uno spazio.</span></td></tr>
      <tr><td>88</td><td></td></tr>
      <tr><td>89</td><td>        <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">buffer</span>[<span class="c2h-val-int">0</span>] <span class="c2h-operator">!=</span> <span class="c2h-val-char">'G'</span> <span class="c2h-operator">||</span> <span class="c2h-identifier">buffer</span>[<span class="c2h-val-int">1</span>] <span class="c2h-operator">!=</span> <span class="c2h-val-char">'E'</span> <span class="c2h-operator">||</span> <span class="c2h-identifier">buffer</span>[<span class="c2h-val-int">2</span>] <span class="c2h-operator">!=</span> <span class="c2h-val-char">'T'</span> <span class="c2h-operator">||</span> <span class="c2h-operator">!</span><span class="c2h-identifier c2h-fcallname">isspace</span>(<span class="c2h-identifier">buffer</span>[<span class="c2h-val-int">3</span>]))</td></tr>
      <tr><td>90</td><td>            {</td></tr>
      <tr><td>91</td><td>                <span class="c2h-comment">// Richiesta non valida</span></td></tr>
      <tr><td>92</td><td>                ..</td></tr>
      <tr><td>93</td><td>            }</td></tr>
      <tr><td>94</td><td></td></tr>
      <tr><td>95</td><td>        <span class="c2h-comment">// Dalla posizione 4 in poi ci aspettiamo una sequenza</span></td></tr>
      <tr><td>96</td><td>        <span class="c2h-comment">// di caratteri fino a quando non raggiungiamo uno spazio</span></td></tr>
      <tr><td>97</td><td>        <span class="c2h-comment">// o la fine del buffer.</span></td></tr>
      <tr><td>98</td><td></td></tr>
      <tr><td>99</td><td>        <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">indice_inizio_percorso</span> <span class="c2h-operator">=</span> <span class="c2h-val-int">4</span>;</td></tr>
      <tr><td>100</td><td></td></tr>
      <tr><td>101</td><td>        <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">i</span> <span class="c2h-operator">=</span> <span class="c2h-val-int">4</span>;</td></tr>
      <tr><td>102</td><td>        <span class="c2h-kword c2h-kword-while">while</span>(<span class="c2h-identifier">i</span> <span class="c2h-operator">&lt;</span> <span class="c2h-identifier">n</span> <span class="c2h-operator">&&</span> <span class="c2h-operator">!</span><span class="c2h-identifier c2h-fcallname">isspace</span>(<span class="c2h-identifier">buffer</span>[<span class="c2h-identifier">i</span>]))</td></tr>
      <tr><td>103</td><td>            <span class="c2h-identifier">i</span> <span class="c2h-operator">+=</span> <span class="c2h-val-int">1</span>;</td></tr>
      <tr><td>104</td><td></td></tr>
      <tr><td>105</td><td>        <span class="c2h-kword c2h-kword-int">int</span> <span class="c2h-identifier">indice_fine_percorso</span> <span class="c2h-operator">=</span> <span class="c2h-identifier">i</span>;</td></tr>
      <tr><td>106</td><td></td></tr>
      <tr><td>107</td><td>        <span class="c2h-kword c2h-kword-if">if</span>(<span class="c2h-identifier">i</span> <span class="c2h-operator">&lt;</span> <span class="c2h-identifier">n</span>)</td></tr>
      <tr><td>108</td><td>            {</td></tr>
      <tr><td>109</td><td>                <span class="c2h-identifier c2h-fcallname">assert</span>();</td></tr>
      <tr><td>110</td><td>                ..</td></tr>
      <tr><td>111</td><td>            }</td></tr>
      <tr><td>112</td><td></td></tr>
      <tr><td>113</td><td>        <span class="c2h-kword c2h-kword-char">char</span> <span class="c2h-operator">*</span><span class="c2h-identifier">file</span> <span class="c2h-operator">=</span> <span class="c2h-identifier">buffer</span> <span class="c2h-operator">+</span> <span class="c2h-val-int">4</span>;</td></tr>
      <tr><td>114</td><td></td></tr>
      <tr><td>115</td><td>    }    </td></tr>
      <tr><td>116</td><td>        </td></tr>
    </table>
  </div>
</div>

	
		<script src="../scripts.js"></script>
	</body>
</html>